{
  "hash": "6dde221ff84c9eab7bedfe660783b483",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"NIVA_Postdoc_AEP\"\nauthor: Sam A. Welch\ndate: 2024.05.09\nformat: \n  html: \n    toc: true\n    code-fold: true\n    code-summary: \"Show code\"\neditor_options: \n  chunk_output_type: inline\n---\n\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)  # tidyverse packages for data cleaning, graphs, etc. \nlibrary(webchem)    # access to chemical database APIs\nlibrary(readxl)     # read Excel files\nlibrary(sf)         # handle geographical data sets\nlibrary(maps)       # default maps of the world\nlibrary(csmaps)     # maps of Norway\nlibrary(giscoR) # more maps\nlibrary(cowplot) # plots in grids\nlibrary(ggthemes) # colour palettes\n\noptions(knitr.kable.NA = '-')\n```\n:::\n\n\n### Data\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get a map of Europe and crop it to Norway\ngisco_Europe <- gisco_get_countries(epsg = 4326, region = \"Europe\") |> \n      st_crop(xmin = 5, xmax = 13, ymin = 57, ymax = 61) \n\ngisco_Europe_zoom <- gisco_get_countries(epsg = 4326, region = \"Europe\") |> \n      st_crop(xmin = 5, xmax = 13, ymin = 48, ymax = 72) \n\nsites_sf <- st_as_sf(sites, coords = c(\"LONGITUDE\", \"LATITUDE\"), crs = 4326) |> \n  select(-COORDINATE_SYSTEM, -SITE_CODE)\n```\n:::\n\n\n## Task A: Import and Visualise Spatiotemporal Exposure Data\n\nWe can find some better plots for this later.\n\nTodo: Pick a unique icon and colour for each site, use throughout\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sampling Map\nplot_a0 <- ggplot(gisco_Europe) +\n  geom_sf() +\n  geom_sf(data = sites_sf) +\n  geom_sf_text(aes(label = NAME_ENGL), colour = \"darkgrey\") +\n      geom_sf(data = sites_sf, aes(size = 5, colour = SITE_NAME)) +\n  geom_sf_text(data = sites_sf, aes(label = c(\"T\", \"V\", \"H\", \"S\", \"M\"))) +\n  theme(legend.position = \"none\", axis.title = element_blank(), axis.ticks = element_blank(), axis.text = element_blank()) +\n      scale_color_few()\n\n# Spatial Variation\n\nplot_a1 <- mcpa_exposure %>% \n  ggplot(mapping = aes(x = SITE_NAME, y = MEASURED_VALUE, colour = SITE_NAME)) +\n  geom_boxplot() +\n    scale_y_log10() +\n  scale_color_few() +\n  labs(x = \"Sampling Site\",\n       y = \"Measured Concentration (μg/L)\",\n       colour = \"Sampling Site\",\n       shape = \"Sampling Site\")\n\n# Temporal Variation\n\nplot_a2 <- mcpa_exposure %>% \n  ggplot(mapping = aes(x = SAMPLE_DATE, y = MEASURED_VALUE, group = floor_date(SAMPLE_DATE, unit = \"months\"))) +\n  geom_boxplot() +\n    scale_y_log10() +\n  labs(x = \"Sampling Date\",\n       y = \"Measured Concentration (μg/L)\",\n       colour = \"Sampling Site\",\n       shape = \"Sampling Site\")\n\n# Spatio-Temporal Variation\n\nplot_a3 <- mcpa_exposure %>%\n  ggplot(mapping = aes(x = SAMPLE_DATE, y = MEASURED_VALUE, colour = SITE_NAME)) +\n  geom_line() +\n  geom_point(size = 5) +\n  geom_text(aes(label = SITE_NAME |> substr(start = 1, stop = 1)), colour = \"black\") +\n  scale_y_log10() +\n  scale_color_few() +\n  labs(\n    x = \"Sampling Date (2019)\",\n    y = \"Measured Concentration (μg/L)\",\n    colour = \"Sampling Site\",\n    shape = \"Sampling Site\"\n  ) +\n  theme(legend.position = \"none\") +\n   annotation_logticks(sides = \"l\")\n\n# task_a_plot <- plot_grid(plot_a3, plot_a0,\n#           ncol = 2, rel_widths = c(3, 1))\n\ntask_a_plot <- ggdraw(plot = plot_a3) +\n  draw_plot(plot_a0, x = 0.8, y = 0.65, width = 0.2, height = 0.3, scale = 1.5)\ntask_a_plot\n```\n\n::: {.cell-output-display}\n![Spatial and Temporal Variation in MCPA Concentrations](NIVA_Postdoc_AEP_files/figure-html/fig1_MCPA_spatiotemporal-1.png){width=672}\n:::\n:::\n\n\n## Task B: Predict tissue concentrations of chemicals in fish\n\nAny outliers?\n\nHow to calculate some of these :(?\n\nAlso how to make nice tables in quarto?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_data_summary <- \nall_data %>% \n  group_by(SITE_NAME, STRESSOR_NAME) %>% \n  summarise(Mean_MEASURED_VALUE = mean(MEASURED_VALUE),\n            SD_MEASURED_VALUE = sd(MEASURED_VALUE),\n            Max_MEASURED_VALUE = max(MEASURED_VALUE),\n            Min_MEASURED_VALUE = min(MEASURED_VALUE),\n            perc_5_MEASURED_VALUE = quantile(MEASURED_VALUE, probs = 0.05),\n            perc_95_MEASURED_VALUE = quantile(MEASURED_VALUE, probs = 0.95)) |> \n  transmute(SITE_NAME,\n            STRESSOR_NAME,\n            Mean_SD = case_when(is.na(SD_MEASURED_VALUE) ~ \n                                  paste0(Mean_MEASURED_VALUE |> round(2), \"*\"),\n                              TRUE ~ \n                                  paste0(Mean_MEASURED_VALUE |> round(2), \" ± \", SD_MEASURED_VALUE |> round(2))\n                             ),\n            Max_MEASURED_VALUE,\n            Min_MEASURED_VALUE,\n            perc_5_MEASURED_VALUE,\n            perc_95_MEASURED_VALUE\n         )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'SITE_NAME'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Make a table using knitr\ntask_b_table <- knitr::kable(all_data_summary, digits = 2,\n             col.names = c(\"Site\", \"Stressor\", \"Mean ± SD\", \"Min.\", \"Max.\", \"5th Percentile\", \"95th Percentile\"),\n              caption = \"Table of mean, standard deviation, maximum, minimum and percentile values of measured concentrations of 48 chemical stressors across 6 freshwater sampling sites in Norway, May 6th to October 28th 2019. *: <i>n</i> too small to calculate standard deviation. All values in μg/L, rounded to 2 d.p.\")\n```\n:::\n\n```{=html}\n<details>\n<summary>Show Table 1: Summary Statistics of Stressor Concentrations</summary>\n```\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Table of mean, standard deviation, maximum, minimum and percentile values of measured concentrations of 48 chemical stressors across 6 freshwater sampling sites in Norway, May 6th to October 28th 2019. *: <i>n</i> too small to calculate standard deviation. All values in μg/L, rounded to 2 d.p.\n\n|Site           |Stressor                                               |Mean ± SD   | Min.| Max.| 5th Percentile| 95th Percentile|\n|:--------------|:------------------------------------------------------|:-----------|----:|----:|--------------:|---------------:|\n|Timebekken     |2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Timebekken     |florasulam                                             |0.02*       | 0.02| 0.02|           0.02|            0.02|\n|Timebekken     |fluroxypyr                                             |0.28 ± 0.15 | 0.46| 0.15|           0.15|            0.44|\n|Timebekken     |metribuzin                                             |0.3 ± 0.41  | 0.59| 0.01|           0.04|            0.56|\n|Timebekken     |propiconazole                                          |0.02*       | 0.02| 0.02|           0.02|            0.02|\n|Vasshaglona    |2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.05 ± 0.07 | 0.16| 0.01|           0.01|            0.14|\n|Vasshaglona    |aclonifen                                              |0.05 ± 0.05 | 0.13| 0.01|           0.01|            0.12|\n|Vasshaglona    |bentazone                                              |0.03 ± 0.01 | 0.04| 0.02|           0.02|            0.04|\n|Vasshaglona    |boscalid                                               |0.05 ± 0.04 | 0.15| 0.01|           0.01|            0.13|\n|Vasshaglona    |chlorfenvinphos                                        |0.02*       | 0.02| 0.02|           0.02|            0.02|\n|Vasshaglona    |clomazone                                              |0.03 ± 0.03 | 0.06| 0.01|           0.01|            0.06|\n|Vasshaglona    |cyazofamid                                             |0.05*       | 0.05| 0.05|           0.05|            0.05|\n|Vasshaglona    |cyprodinil                                             |0.03 ± 0.03 | 0.07| 0.01|           0.01|            0.07|\n|Vasshaglona    |fenamidone                                             |0.21 ± 0.21 | 0.36| 0.06|           0.07|            0.34|\n|Vasshaglona    |fludioxonil                                            |0.02 ± 0.01 | 0.04| 0.01|           0.01|            0.03|\n|Vasshaglona    |fluroxypyr                                             |0.07 ± 0.02 | 0.09| 0.06|           0.06|            0.08|\n|Vasshaglona    |imidacloprid                                           |0.02 ± 0.01 | 0.03| 0.02|           0.02|            0.03|\n|Vasshaglona    |mandipropamid                                          |0.04 ± 0.04 | 0.13| 0.01|           0.01|            0.11|\n|Vasshaglona    |metribuzin                                             |0.08 ± 0.07 | 0.19| 0.02|           0.02|            0.18|\n|Vasshaglona    |pencycuron                                             |0.05 ± 0.06 | 0.17| 0.01|           0.01|            0.13|\n|Vasshaglona    |propamocarb                                            |0.1 ± 0.15  | 0.37| 0.01|           0.01|            0.31|\n|Vasshaglona    |pyridafol                                              |0.08 ± 0.1  | 0.24| 0.01|           0.01|            0.22|\n|Vasshaglona    |spinosad                                               |0.03*       | 0.03| 0.03|           0.03|            0.03|\n|Vasshaglona    |thiacloprid                                            |0.07 ± 0.07 | 0.12| 0.02|           0.02|            0.11|\n|Heiabekken     |1,1'-(2,2-Dichloro-1,1-ethenediyl)bis(4-chlorobenzene) |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Heiabekken     |2,6-dichlorobenzamide (BAM)                            |0.02*       | 0.02| 0.02|           0.02|            0.02|\n|Heiabekken     |2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.5 ± 0.59  | 1.40| 0.01|           0.02|            1.33|\n|Heiabekken     |bixafen                                                |0.02 ± 0.01 | 0.02| 0.01|           0.01|            0.02|\n|Heiabekken     |boscalid                                               |0.04 ± 0.02 | 0.08| 0.02|           0.02|            0.07|\n|Heiabekken     |clopyralid                                             |0.11*       | 0.11| 0.11|           0.11|            0.11|\n|Heiabekken     |diflufenican                                           |0.02 ± 0.01 | 0.03| 0.01|           0.01|            0.03|\n|Heiabekken     |fluroxypyr                                             |0.16*       | 0.16| 0.16|           0.16|            0.16|\n|Heiabekken     |imidacloprid                                           |1.14 ± 1.38 | 5.30| 0.21|           0.23|            3.10|\n|Heiabekken     |mandipropamid                                          |0.15 ± 0.19 | 0.36| 0.01|           0.02|            0.33|\n|Heiabekken     |metalaxyl                                              |0.03 ± 0.02 | 0.06| 0.01|           0.01|            0.06|\n|Heiabekken     |metamitron                                             |0.02 ± 0.01 | 0.03| 0.01|           0.01|            0.03|\n|Heiabekken     |metribuzin                                             |0.18 ± 0.43 | 1.40| 0.01|           0.01|            0.81|\n|Heiabekken     |pencycuron                                             |0.18 ± 0.26 | 0.93| 0.01|           0.02|            0.61|\n|Heiabekken     |propamocarb                                            |0.52 ± 1.14 | 3.90| 0.03|           0.03|            2.34|\n|Heiabekken     |propoxycarbazone                                       |0.02 ± 0    | 0.02| 0.02|           0.02|            0.02|\n|Heiabekken     |prothioconazole-desthio                                |0.04 ± 0.03 | 0.09| 0.01|           0.01|            0.08|\n|Heiabekken     |pyraclostrobin                                         |0.02 ± 0.01 | 0.02| 0.01|           0.01|            0.02|\n|Heiabekken     |spinosad                                               |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Heiabekken     |trifloxystrobin                                        |0.03*       | 0.03| 0.03|           0.03|            0.03|\n|Skuterudbekken |2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.43 ± 0.61 | 1.40| 0.01|           0.01|            1.34|\n|Skuterudbekken |bixafen                                                |0.02 ± 0.01 | 0.03| 0.01|           0.01|            0.03|\n|Skuterudbekken |boscalid                                               |0.02 ± 0    | 0.02| 0.01|           0.01|            0.02|\n|Skuterudbekken |carbendazim                                            |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Skuterudbekken |clopyralid                                             |0.13 ± 0.08 | 0.23| 0.05|           0.06|            0.22|\n|Skuterudbekken |dichlorprop                                            |0.04*       | 0.04| 0.04|           0.04|            0.04|\n|Skuterudbekken |fluroxypyr                                             |0.26 ± 0.21 | 0.60| 0.09|           0.09|            0.53|\n|Skuterudbekken |imidacloprid                                           |0.02*       | 0.02| 0.02|           0.02|            0.02|\n|Skuterudbekken |mecoprop                                               |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Skuterudbekken |propiconazole                                          |0.02 ± 0    | 0.02| 0.02|           0.02|            0.02|\n|Skuterudbekken |prothioconazole-desthio                                |0.05 ± 0.05 | 0.11| 0.01|           0.01|            0.10|\n|Skuterudbekken |pyroxsulam                                             |0.01 ± 0    | 0.02| 0.01|           0.01|            0.02|\n|Mørdrebekken   |2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.33 ± 0.55 | 1.30| 0.05|           0.05|            1.08|\n|Mørdrebekken   |azoxystrobin                                           |0.02 ± 0.01 | 0.03| 0.01|           0.01|            0.03|\n|Mørdrebekken   |bentazone                                              |0.21 ± 0.2  | 0.43| 0.03|           0.03|            0.41|\n|Mørdrebekken   |bixafen                                                |0.01*       | 0.01| 0.01|           0.01|            0.01|\n|Mørdrebekken   |clopyralid                                             |0.2*        | 0.20| 0.20|           0.20|            0.20|\n|Mørdrebekken   |fenpropimorph                                          |0.05*       | 0.05| 0.05|           0.05|            0.05|\n|Mørdrebekken   |fluroxypyr                                             |0.25 ± 0.2  | 0.39| 0.11|           0.12|            0.38|\n|Mørdrebekken   |pencycuron                                             |0.07 ± 0.04 | 0.10| 0.04|           0.04|            0.10|\n|Mørdrebekken   |pinoxaden                                              |0.03*       | 0.03| 0.03|           0.03|            0.03|\n|Mørdrebekken   |propiconazole                                          |0.16 ± 0.28 | 0.58| 0.01|           0.01|            0.50|\n|Mørdrebekken   |prothioconazole-desthio                                |0.03 ± 0.04 | 0.09| 0.01|           0.01|            0.08|\n|Mørdrebekken   |thiabendazole                                          |0.04*       | 0.04| 0.04|           0.04|            0.04|\n\n\n:::\n:::\n\n\n</details>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Try and import the (already downloaded and saved) chem properties, try importing if it doesn't work\ntry_import_webchem <- try(webchem_chemicals <- read_csv(file = \"data/webchem_chemical_data.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 40 Columns: 6\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (3): STRESSOR_NAME, CAS, INCHIKEY\ndbl (3): STRESSOR_ID, CID, XLogP\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nif (inherits(x = try_import_webchem, what = \"try-error\")) {\n  print(\"Chemical data not found, importing from Pubchem via Webchem.\")\n  # Get the relevant CIDs from InChiKeys, then look up LogKOW/XLogP on Pubchem\n  webchem_chemicals <- all_stressors |> \n  mutate(CID = get_cid(INCHIKEY, from = \"inchikey\", match = \"first\")$cid,\n         XLogP = pc_prop(CID, properties = \"XLogP\")$XLogP)\n  # Save to data to avoid unecessary API calls\n  write_csv(x = webchem_chemicals, file = \"data/webchem_chemical_data.csv\")\n}\n\n# Predict tissue concentration in fish for all chemicals and sites\nCf_all_stressors <- all_data |> \n  left_join(webchem_chemicals |> select(-STRESSOR_ID, -INCHIKEY, -CAS), by = \"STRESSOR_NAME\") |> \n  mutate(FISH_CONC_uGKG = MEASURED_VALUE * 10 ^ (0.76 * XLogP - 0.23))\n\n# Make a table summarising mean concentrations in fish by site and stressor\nCf_summary <- Cf_all_stressors |> \n    group_by(SITE_NAME, STRESSOR_NAME) %>% \n  summarise(Mean_MEASURED_VALUE = mean(MEASURED_VALUE),\n            SD_MEASURED_VALUE = sd(MEASURED_VALUE)) |> \n  transmute(SITE_NAME,\n            STRESSOR_NAME,\n            Mean_SD = case_when(is.na(SD_MEASURED_VALUE) ~ \n                                  paste0(Mean_MEASURED_VALUE |> round(2), \"*\"),\n                              TRUE ~ \n                                  paste0(Mean_MEASURED_VALUE |> round(2), \" ± \", SD_MEASURED_VALUE |> round(2))\n                             )\n         ) |> \n  pivot_wider(values_from = Mean_SD, names_from = SITE_NAME)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'SITE_NAME'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Make a pretty table using knitr\nCf_summary_table <- knitr::kable(Cf_summary, digits = 2,\n             col.names = c(\"Stressor\", \"Heiabekken\", \"Mørdrebekken\", \"Skuterudbekken\", \"Timebekken\", \"Vasshaglona\"),\n              caption = \"Table of mean and standard deviation of measured concentrations of 48 chemical stressors across 6 freshwater sampling sites in Norway, May 6th to October 28th 2019. *: n too small to calculate standard deviation. All values in μg/L.\")\n```\n:::\n\n```{=html}\n<details>\n<summary>Show Table 2: Cf_summary_table</summary>\n```\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: Table of mean and standard deviation of measured concentrations of 48 chemical stressors across 6 freshwater sampling sites in Norway, May 6th to October 28th 2019. *: n too small to calculate standard deviation. All values in μg/L.\n\n|Stressor                                               |Heiabekken  |Mørdrebekken |Skuterudbekken |Timebekken  |Vasshaglona |\n|:------------------------------------------------------|:-----------|:------------|:--------------|:-----------|:-----------|\n|2-methyl-4-chlorophenoxyacetic acid (MCPA)             |0.01*       |0.05 ± 0.07  |0.5 ± 0.59     |0.43 ± 0.61 |0.33 ± 0.55 |\n|florasulam                                             |0.02*       |-            |-              |-           |-           |\n|fluroxypyr                                             |0.28 ± 0.15 |0.07 ± 0.02  |0.16*          |0.26 ± 0.21 |0.25 ± 0.2  |\n|metribuzin                                             |0.3 ± 0.41  |0.08 ± 0.07  |0.18 ± 0.43    |-           |-           |\n|propiconazole                                          |0.02*       |-            |-              |0.02 ± 0    |0.16 ± 0.28 |\n|aclonifen                                              |-           |0.05 ± 0.05  |-              |-           |-           |\n|bentazone                                              |-           |0.03 ± 0.01  |-              |-           |0.21 ± 0.2  |\n|boscalid                                               |-           |0.05 ± 0.04  |0.04 ± 0.02    |0.02 ± 0    |-           |\n|chlorfenvinphos                                        |-           |0.02*        |-              |-           |-           |\n|clomazone                                              |-           |0.03 ± 0.03  |-              |-           |-           |\n|cyazofamid                                             |-           |0.05*        |-              |-           |-           |\n|cyprodinil                                             |-           |0.03 ± 0.03  |-              |-           |-           |\n|fenamidone                                             |-           |0.21 ± 0.21  |-              |-           |-           |\n|fludioxonil                                            |-           |0.02 ± 0.01  |-              |-           |-           |\n|imidacloprid                                           |-           |0.02 ± 0.01  |1.14 ± 1.38    |0.02*       |-           |\n|mandipropamid                                          |-           |0.04 ± 0.04  |0.15 ± 0.19    |-           |-           |\n|pencycuron                                             |-           |0.05 ± 0.06  |0.18 ± 0.26    |-           |0.07 ± 0.04 |\n|propamocarb                                            |-           |0.1 ± 0.15   |0.52 ± 1.14    |-           |-           |\n|pyridafol                                              |-           |0.08 ± 0.1   |-              |-           |-           |\n|spinosad                                               |-           |0.03*        |0.01*          |-           |-           |\n|thiacloprid                                            |-           |0.07 ± 0.07  |-              |-           |-           |\n|1,1'-(2,2-Dichloro-1,1-ethenediyl)bis(4-chlorobenzene) |-           |-            |0.01*          |-           |-           |\n|2,6-dichlorobenzamide (BAM)                            |-           |-            |0.02*          |-           |-           |\n|bixafen                                                |-           |-            |0.02 ± 0.01    |0.02 ± 0.01 |0.01*       |\n|clopyralid                                             |-           |-            |0.11*          |0.13 ± 0.08 |0.2*        |\n|diflufenican                                           |-           |-            |0.02 ± 0.01    |-           |-           |\n|metalaxyl                                              |-           |-            |0.03 ± 0.02    |-           |-           |\n|metamitron                                             |-           |-            |0.02 ± 0.01    |-           |-           |\n|propoxycarbazone                                       |-           |-            |0.02 ± 0       |-           |-           |\n|prothioconazole-desthio                                |-           |-            |0.04 ± 0.03    |0.05 ± 0.05 |0.03 ± 0.04 |\n|pyraclostrobin                                         |-           |-            |0.02 ± 0.01    |-           |-           |\n|trifloxystrobin                                        |-           |-            |0.03*          |-           |-           |\n|carbendazim                                            |-           |-            |-              |0.01*       |-           |\n|dichlorprop                                            |-           |-            |-              |0.04*       |-           |\n|mecoprop                                               |-           |-            |-              |0.01*       |-           |\n|pyroxsulam                                             |-           |-            |-              |0.01 ± 0    |-           |\n|azoxystrobin                                           |-           |-            |-              |-           |0.02 ± 0.01 |\n|fenpropimorph                                          |-           |-            |-              |-           |0.05*       |\n|pinoxaden                                              |-           |-            |-              |-           |0.03*       |\n|thiabendazole                                          |-           |-            |-              |-           |0.04*       |\n\n\n:::\n:::\n\n\n</details>\n\n## Task C: Visualize the values of Cw and Cf on a map\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntask_c_data <- Cf_all_stressors |>\n  left_join(sites_sf, by = \"SITE_NAME\") |>\n  left_join(all_stressors, by = \"STRESSOR_NAME\") |>\n  pivot_longer(cols = c(MEASURED_VALUE, FISH_CONC_uGKG), names_to = \"Media\", values_to = \"Stressor_ug\") |>\n  mutate(Media = case_when(\n    Media == \"MEASURED_VALUE\" ~ \"Water\",\n    TRUE ~ \"Fish\"\n  ))\n\ntask_c_map <-\n  ggplot(gisco_Europe_zoom) +\n  geom_sf() +\n  geom_sf(data = sites_sf) +\n  geom_sf_text(aes(label = NAME_ENGL), colour = \"darkgrey\") +\n      geom_sf(data = sites_sf, aes(size = 5, colour = SITE_NAME)) +\n  geom_sf_text(data = sites_sf, aes(label = c(\"T\", \"V\", \"H\", \"S\", \"M\"))) +\n  theme(legend.position = \"none\", axis.title = element_blank(), axis.ticks = element_blank(), axis.text = element_blank()) +\n      scale_color_few()\n\ntask_c_plot_list <- vector(\"list\", 10)\nn <- 0\n\n\nfor (site in sites$SITE_NAME) {\n  for (medium in c(\"Water\", \"Fish\")) {\n    n <- n + 1\n    temp_data <- task_c_data |> filter(Media == medium)\n    temp_plot <- temp_data |>\n      filter(SITE_NAME == site) |>\n      ggplot(aes(x = Stressor_ug, y = STRESSOR_ACRONYM)) +\n      geom_boxplot() +\n      scale_x_log10() +\n      labs(\n        x = \"Measured Concentration (μg/L)\",\n        y = \"Stressor (Abbreviated)\",\n        title = paste0(site, \" (\", medium, \")\")\n      ) +\n      annotation_logticks(sides = \"l\") +\n      theme(axis.title = element_blank())\n    task_c_plot_list[[n]] <- temp_plot\n  }\n}\n\n\n# y.grob <- textGrob(\"Stressor\", \n#                    gp=gpar(fontface=\"bold\", fontsize=15), rot=90)\n# \n# x.grob <- textGrob(\"Concentration (μg/L)\", \n#                    gp=gpar(fontface=\"bold\", fontsize=15))\n\ntask_c_boxplots <- plot_grid(\n  plotlist = task_c_plot_list,\n  nrow = 5, ncol = 2\n)\nplot_grid(task_c_boxplots, task_c_map, ncol = 2, nrow = 1, rel_width = c(2, 1))\n```\n\n::: {.cell-output-display}\n![](NIVA_Postdoc_AEP_files/figure-html/task_c-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "NIVA_Postdoc_AEP_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}